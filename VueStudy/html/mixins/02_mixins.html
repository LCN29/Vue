<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script type="text/javascript" src="../../js/vue.js" ></script>
	</head>
	<body>
		
		<div id="example">
			
		</div>
		
		<script>
			// 定义一个混合对象
			var myMixin = {
				template : `<div>123</div>`,
				beforeCreate : function(){
					console.log('123');
				},
				created: function () {
				    this.hello();
				},
				methods: {
					hello: function () {
						console.log('hello from mixin!');
					}
				}
			};
			
			// 定义一个使用混合对象的组件
			var Component = Vue.extend({
			  mixins: [myMixin]
			});
			
			var component = new Component();
			component.$mount("#example");
			
			
			
			/*===========================*/
			/*
			 	同名钩子函数将混合为一个数组，因此都将被调用
			 	钩子将在组件自身钩子之前调用 
			 * */
			
			var mixin = {
			  	created: function () {
			    	console.log('混合对象的钩子被调用')
			  	}
			};
			
			new Vue({
				mixins: [mixin],
				created: function () {
				    console.log('组件钩子被调用')
				}
			});
			
			/*=========================================*/
			/*
			 	值为对象的选项 methods, components 和 directives
			 	将被混合为同一个对象。两个对象键名冲突时，取组件
			 	对象的键值对。
			 */
			
			var mixin = {
			  	methods: {
				    foo: function () {
				      	console.log('foo')
				    },
				    conflicting: function () {
				      	console.log('from mixin')
				    }
			  	}
			};
			
			var vm = new Vue({
				mixins : [mixin],
				methods: {
				    bar: function () {
				      console.log('bar')
				    },
				    conflicting: function () {
				      console.log('from self')
				    }
				}
			});
			
			vm.foo(); 		// => "foo"
			vm.bar(); 		// => "bar"
			vm.conflicting(); //=> "from self"
			
			
			/*================================*/
			/* 全局注册*/
			Vue.mixin({
				created: function () {
					var myOption = this.$options.myOption;
				    if (myOption) {
				      console.log(myOption)
				    }
				},
			});
			
			new Vue({
			  	myOption: 'hello!'
			});
			
			/*======================================*/
			/*自定义合并策略*/
			var strategies = Vue.config.optionMergeStrategies;
			strategies.myOption = strategies.methods;
			/* 更高级合并 */
			const merge = Vue.config.optionMergeStrategies.computed
			Vue.config.optionMergeStrategies.vuex = function (toVal, fromVal) {
			  if (!toVal) return fromVal
			  if (!fromVal) return toVal
			  return {
			    getters: merge(toVal.getters, fromVal.getters),
			    state: merge(toVal.state, fromVal.state),
			    actions: merge(toVal.actions, fromVal.actions)
			  }
			}
		</script>
	</body>
</html>
