<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		
		<script type="text/javascript" src="../js/vue.js" ></script>
		<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
		<style>
			
		</style>
	</head>
	<body>
		
		<!--
			有时候，进入某个路由后，需要从服务器获取数据
			通常 为
			
			导航完成之后获取    ： 先完成导航，然后在接下来的组件
			生命周期钩子中获取数据。在数据获取期间显示『加载中』之类的指示。
			
			导航完成之前获取
			
			导航完成前，在路由进入的守卫中获取数据，在数据获取成功后执行导航。
			
		-->
		
		<div id="app">
			
		</div>
		
		
		
		<script>
			
			/* 导航完成后获取数据 */
			var app = new Vue({
				el : '#app',
				data : {
					loading: false,
				    post: null,
				    error: null
				}
				created () {
				    // 组件创建完后获取数据，
				    // 此时 data 已经被 observed 了
				    this.fetchData()
				},
				watch: {
				    // 如果路由有变化，会再次执行该方法
				    '$route': 'fetchData'
				},
				methods: {
					fetchData () {
						this.error = this.post = null
      					this.loading = true
      					getPost(this.$route.params.id, (err, post) => {
      						this.loading = false
      						f (err) {
					          this.error = err.toString()
					        } else {
					          this.post = post
					        }
      					}
					}
				}
			});
			
			/* 在导航完成前获取数据 */
			
			export default {
				data () {
				    return {
				      post: null,
				      error: null
				    }
				},
				beforeRouteEnter (to, from, next) {
					getPost(to.params.id, (err, post) => {
				      	next(vm => vm.setData(err, post))
				    });
				},
				
				// 路由改变前，组件就已经渲染完了
  				// 逻辑稍稍不同
				beforeRouteUpdate (to, from, next) {
					this.post = null
				    getPost(to.params.id, (err, post) => {
				      this.setData(err, post)
				      next()
				    });
				},
				methods: {
					setData (err, post) {
						if (err) {
					        this.error = err.toString()
					    } else {
					        this.post = post
					    }
					}
				}
			}
			
		</script>
	</body>
</html>
